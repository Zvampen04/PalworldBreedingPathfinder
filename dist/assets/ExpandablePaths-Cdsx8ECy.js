import{R as Q,j as n,r as f}from"./index-CJprxvWR.js";import{T as B,u as V,i as W,b as X,B as F,t as Y}from"./App-DCGyl0GU.js";const T=({step:t,isLast:b=!1,showCheckbox:C=!1,path:g,completedStepsMap:y,favoriteIds:$,handleStepToggle:v})=>{var p;const i=Q.useContext(B),m=(i==null?void 0:i.mode)==="dark";if(t.type==="start")return null;const h=g&&((p=y[g.id])==null?void 0:p.has(t.step_number));return n.jsxs("div",{className:`flex items-center space-x-2 ${b?m?"text-green-400 font-medium":"text-green-600 font-medium":m?"text-gray-300":"text-gray-700"} ${h?"opacity-60 line-through":""}`,children:[C&&g&&$[g.id]&&n.jsx("input",{type:"checkbox",checked:h,onChange:x=>{x.stopPropagation(),v(g,t.step_number)},onClick:x=>x.stopPropagation(),className:"w-4 h-4 rounded border-2 focus:ring-2 focus:ring-blue-500","aria-checked":h,"aria-label":`Mark step ${t.step_number} as completed for breeding path from ${t.parents} to ${t.result}`}),n.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs ${b?m?"bg-green-800 text-green-200":"bg-green-100 text-green-800":m?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"} ${h?"bg-green-600 text-white":""}`,children:h?"âœ“":t.step_number}),n.jsxs("span",{children:[t.parents," â†’ ",t.result]}),b&&n.jsx("span",{className:`text-xs px-2 py-1 rounded ${m?"bg-green-800 text-green-200":"bg-green-100 text-green-800"}`,children:"TARGET"})]})},se=({data:t,hideSummaryHeader:b=!1,summaryHeaderText:C,onAddToCollection:g,bottomAction:y,onRemoveFavorite:$})=>{const v=f.useContext(B),i=(v==null?void 0:v.mode)==="dark",{addFavorite:m,removeFavorite:h}=V(),[p,x]=f.useState({}),[k,S]=f.useState({}),{memoizedFavoriteIds:z,memoizedCompletedStepsMap:A}=f.useMemo(()=>{if(t.success&&Array.isArray(t.paths)){const e={},o={},r=a=>{a.forEach(s=>{if(s.type==="single"&&s.path){const l=W(t.start_parent,t.target_child,s.path.steps);if(e[s.path.id]=l,l){const c=X(l);c&&(o[s.path.id]=c.completedSteps)}}else s.type==="group"&&s.children&&r(s.children)})};return r(t.paths),{memoizedFavoriteIds:e,memoizedCompletedStepsMap:o}}return{memoizedFavoriteIds:{},memoizedCompletedStepsMap:{}}},[t.start_parent,t.target_child,t.success,t.paths]);f.useEffect(()=>{x(z),S(A)},[z,A]);const U=e=>{if(!t.success)return;const o=p[e.id];if(o)h(o),x(r=>({...r,[e.id]:null})),S(r=>({...r,[e.id]:new Set})),typeof $=="function"&&$(e);else{const r=e.steps.find(d=>d.type==="start"),a=e.steps.find(d=>d.is_final),s=t.start_parent||(r==null?void 0:r.pal)||"Unknown Parent",l=t.target_child||(a==null?void 0:a.result)||"Unknown Child",c={name:`${s} â†’ ${l}`,startParent:s,targetChild:l,steps:e.steps},u=m(c);x(d=>({...d,[e.id]:u}))}},P=(e,o)=>{const r=p[e.id];if(!r)return;Y(r,o);const a=k[e.id]||new Set,s=new Set(a);s.has(o)?s.delete(o):s.add(o),S(l=>({...l,[e.id]:s})),window.dispatchEvent(new CustomEvent("favoritesUpdated"))},G=(e,o=!0,r=!1)=>{const a=p[e.id];return n.jsxs("div",{className:"border-l-2 border-blue-200 pl-4 space-y-3 relative flex flex-col pb-14",children:[n.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[n.jsx(F,{onClick:s=>{s.stopPropagation(),U(e)},variant:a?"danger":"primary",size:"sm",dark:i,title:a?"Remove from favorites":"Add to favorites","aria-label":a?"Remove from favorites":"Add to favorites",className:a?"":"shadow-lg hover:shadow-xl",children:"â­"}),n.jsx(F,{onClick:s=>{s.stopPropagation(),g&&g(e)},variant:"primary",size:"sm",dark:i,title:"Add to collection","aria-label":`Add path from ${t.start_parent} to ${t.target_child} to collection`,className:"",children:n.jsx("span",{role:"img","aria-label":"Add to collection",children:"ðŸ“š"})})]}),o&&n.jsxs("div",{className:`text-sm ${i?"text-accessible-secondary-dark":"text-accessible-secondary-light"} mb-2`,children:[e.total_steps," breeding step",e.total_steps!==1?"s":""]}),e.steps.filter(s=>s.type!=="start").map((s,l,c)=>n.jsxs("div",{className:"relative",children:[n.jsx(T,{step:s,isLast:s.is_final,showCheckbox:r,path:e,completedStepsMap:k,favoriteIds:p,handleStepToggle:P}),l<c.length-1&&n.jsx("div",{className:"ml-3 w-px h-4 bg-gray-300"})]},l)),typeof y=="function"?y(e):y]})},[M,L]=f.useState(()=>{const e=new Map;if(Array.isArray(t.paths)){const o=t.paths.filter(a=>a.type==="single"),r=t.paths.filter(a=>a.type==="group");o.length===1&&r.length===1&&r[0].common_steps&&r[0].common_steps.length>0&&r[0].children?e.set("root-0-group",!0):t.paths.forEach((a,s)=>{a.type==="group"&&e.set(`root-${s}-group`,!0)})}return e}),E=e=>{L(o=>{const r=new Map(o);return r.set(e,!r.get(e)),r})},H=["bg-gray-800","bg-gray-900","bg-gray-700"],q=["border-gray-600","border-gray-700","border-gray-500"],J=["bg-white","bg-gray-100","bg-gray-200"],K=["border-gray-200","border-gray-300","border-gray-400"],w=(e,o,r,a,s)=>{var I,D,R;const l=i?H[o%3]:J[o%3],c=i?q[o%3]:K[o%3];if(e.type==="single")return n.jsx("div",{className:`border rounded-xl-std p-4 shadow-xl-std ${l} ${c}`,children:e.path&&G(e.path,!0,!0)},r);const u=`${r}-group`,d=a.get(u)||!1;return n.jsx("div",{className:`border rounded-xl-std shadow-xl-std ${l} ${c}`,children:n.jsxs("div",{className:"p-4",children:[n.jsx("div",{className:"flex items-center justify-between mb-3",children:n.jsxs("h4",{className:`text-sm font-medium ${i?"text-gray-100":"text-gray-900"}`,children:[N(e)," Alternative Path",N(e)!==1?"s":""," (",((R=(D=(I=e.children)==null?void 0:I[0])==null?void 0:D.path)==null?void 0:R.total_steps)||0," steps)"]})}),e.common_steps&&e.common_steps.length>0&&n.jsxs("div",{className:"mb-4 border-l-2 border-blue-200 pl-4 space-y-3",children:[n.jsx("div",{className:`text-xs mb-2 ${i?"text-gray-400":"text-gray-600"}`,children:"Common steps:"}),e.common_steps.filter(j=>j.type!=="start").map((j,_,O)=>n.jsxs("div",{className:"relative",children:[n.jsx(T,{step:j,isLast:!1,showCheckbox:!0,completedStepsMap:k,favoriteIds:p,handleStepToggle:P}),_<O.length-1&&n.jsx("div",{className:"ml-3 w-px h-4 bg-gray-300"})]},_))]}),n.jsx(F,{onClick:()=>s(u),variant:"secondary",size:"md",dark:i,className:`w-full text-left p-3 rounded border transition-colors ${i?"bg-gray-700 hover:bg-gray-600 border-gray-600":"bg-gray-50 hover:bg-gray-100 border-gray-200"}`,children:n.jsx("div",{className:"flex items-center justify-between",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("span",{className:`transform transition-transform ${d?"rotate-90":""}`,children:"â–¶"}),n.jsx("span",{className:`text-sm font-medium ${i?"text-gray-200":"text-gray-700"}`,children:d?"Hide alternatives":`Show ${N(e)} alternative${N(e)!==1?"s":""}`})]})})}),d&&e.children&&n.jsx("div",{className:"mt-3 space-y-3",children:e.children.map((j,_)=>w(j,o+1,`${u}-${_}`,a,s))})]})},u)},N=e=>e.children?e.children.filter(o=>o.type==="single"||o.type==="group").length:0;return n.jsxs("div",{className:"space-y-4 mt-8",children:[!b&&n.jsxs("div",{className:`rounded-xl-std p-4 border ${i?"bg-green-900/30 border-green-800/50":"bg-green-50 border-green-200"}`,children:[n.jsx("div",{className:`font-medium ${i?"text-accessible-dark":"text-accessible-light"}`,children:C||`Found ${t.total_paths} breeding path${t.total_paths!==1?"s":""}`}),n.jsxs("div",{className:`text-sm ${i?"text-accessible-secondary-dark":"text-accessible-secondary-light"}`,children:[t.start_parent," â†’ ",t.target_child," (minimum ",t.min_steps," steps)"]})]}),n.jsx("div",{className:"space-y-3",children:Array.isArray(t.paths)&&t.paths.length>0?(()=>{const e=t.paths.filter(r=>r.type==="single"),o=t.paths.filter(r=>r.type==="group");if(e.length===1&&o.length===1&&o[0].common_steps&&o[0].common_steps.length>0&&o[0].children){const r=o[0],a=[e[0],...r.children],s={...r,children:a};return[w(s,0,"root-0",M,E)]}return t.paths.flatMap((r,a)=>{const s=r;return s.type==="group"&&(!s.common_steps||s.common_steps.length===0)&&s.children?s.children.map((l,c)=>l.type==="single"?w(l,0,`root-${a}-child-${c}`,M,E):null):[w(s,0,`root-${a}`,M,E)]})})():n.jsx("div",{className:"text-center text-gray-400",children:"No breeding paths found."})})]})};export{se as E};
