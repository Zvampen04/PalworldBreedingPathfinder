import{R as J,T as D,j as r,r as u,u as K,i as O,b as Q,B as E,t as V}from"./index-BO6fqV-R.js";const I=({step:t,isLast:f=!1,showCheckbox:N=!1,path:g,completedStepsMap:b,favoriteIds:v,handleStepToggle:F})=>{const m=J.useContext(D)?.mode==="dark";if(t.type==="start")return null;const h=g&&b[g.id]?.has(t.step_number);return r.jsxs("div",{className:`flex items-center space-x-2 ${f?m?"text-green-400 font-medium":"text-green-600 font-medium":m?"text-gray-300":"text-gray-700"} ${h?"opacity-60 line-through":""}`,children:[N&&g&&v[g.id]&&r.jsx("input",{type:"checkbox",checked:h,onChange:d=>{d.stopPropagation(),F(g,t.step_number)},onClick:d=>d.stopPropagation(),className:"w-4 h-4 rounded border-2 focus:ring-2 focus:ring-blue-500","aria-checked":h,"aria-label":`Mark step ${t.step_number} as completed for breeding path from ${t.parents} to ${t.result}`}),r.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs ${f?m?"bg-green-800 text-green-200":"bg-green-100 text-green-800":m?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"} ${h?"bg-green-600 text-white":""}`,children:h?"âœ“":t.step_number}),r.jsxs("span",{children:[t.parents," â†’ ",t.result]}),f&&r.jsx("span",{className:`text-xs px-2 py-1 rounded ${m?"bg-green-800 text-green-200":"bg-green-100 text-green-800"}`,children:"TARGET"})]})},X=({data:t,hideSummaryHeader:f=!1,summaryHeaderText:N,onAddToCollection:g,bottomAction:b,onRemoveFavorite:v})=>{const l=u.useContext(D)?.mode==="dark",{addFavorite:m,removeFavorite:h}=K(),[d,_]=u.useState({}),[C,S]=u.useState({}),{memoizedFavoriteIds:z,memoizedCompletedStepsMap:A}=u.useMemo(()=>{if(t.success&&Array.isArray(t.paths)){const e={},o={},n=a=>{a.forEach(s=>{if(s.type==="single"&&s.path){const i=O(t.start_parent,t.target_child,s.path.steps);if(e[s.path.id]=i,i){const c=Q(i);c&&(o[s.path.id]=c.completedSteps)}}else s.type==="group"&&s.children&&n(s.children)})};return n(t.paths),{memoizedFavoriteIds:e,memoizedCompletedStepsMap:o}}return{memoizedFavoriteIds:{},memoizedCompletedStepsMap:{}}},[t.start_parent,t.target_child,t.success,t.paths]);u.useEffect(()=>{_(z),S(A)},[z,A]);const R=e=>{if(!t.success)return;const o=d[e.id];if(o)h(o),_(n=>({...n,[e.id]:null})),S(n=>({...n,[e.id]:new Set})),typeof v=="function"&&v(e);else{const n=e.steps.find(p=>p.type==="start"),a=e.steps.find(p=>p.is_final),s=t.start_parent||n?.pal||"Unknown Parent",i=t.target_child||a?.result||"Unknown Child",c={name:`${s} â†’ ${i}`,startParent:s,targetChild:i,steps:e.steps},x=m(c);_(p=>({...p,[e.id]:x}))}},P=(e,o)=>{const n=d[e.id];if(!n)return;V(n,o);const a=C[e.id]||new Set,s=new Set(a);s.has(o)?s.delete(o):s.add(o),S(i=>({...i,[e.id]:s})),window.dispatchEvent(new CustomEvent("favoritesUpdated"))},T=(e,o=!0,n=!1)=>{const a=d[e.id];return r.jsxs("div",{className:"border-l-2 border-blue-200 pl-4 space-y-3 relative flex flex-col pb-14",children:[r.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[r.jsx(E,{onClick:s=>{s.stopPropagation(),R(e)},variant:a?"danger":"primary",size:"sm",dark:l,title:a?"Remove from favorites":"Add to favorites","aria-label":a?"Remove from favorites":"Add to favorites",className:a?"":"shadow-lg hover:shadow-xl",children:"â­"}),r.jsx(E,{onClick:s=>{s.stopPropagation(),g&&g(e)},variant:"primary",size:"sm",dark:l,title:"Add to collection","aria-label":`Add path from ${t.start_parent} to ${t.target_child} to collection`,className:"",children:r.jsx("span",{role:"img","aria-label":"Add to collection",children:"ðŸ“š"})})]}),o&&r.jsxs("div",{className:`text-sm ${l?"text-accessible-secondary-dark":"text-accessible-secondary-light"} mb-2`,children:[e.total_steps," breeding step",e.total_steps!==1?"s":""]}),e.steps.filter(s=>s.type!=="start").map((s,i,c)=>r.jsxs("div",{className:"relative",children:[r.jsx(I,{step:s,isLast:s.is_final,showCheckbox:n,path:e,completedStepsMap:C,favoriteIds:d,handleStepToggle:P}),i<c.length-1&&r.jsx("div",{className:"ml-3 w-px h-4 bg-gray-300"})]},i)),typeof b=="function"?b(e):b]})},[k,B]=u.useState(()=>{const e=new Map;if(Array.isArray(t.paths)){const o=t.paths.filter(a=>a.type==="single"),n=t.paths.filter(a=>a.type==="group");o.length===1&&n.length===1&&n[0].common_steps&&n[0].common_steps.length>0&&n[0].children?e.set("root-0-group",!0):t.paths.forEach((a,s)=>{a.type==="group"&&e.set(`root-${s}-group`,!0)})}return e}),M=e=>{B(o=>{const n=new Map(o);return n.set(e,!n.get(e)),n})},U=["bg-gray-800","bg-gray-900","bg-gray-700"],G=["border-gray-600","border-gray-700","border-gray-500"],L=["bg-white","bg-gray-100","bg-gray-200"],H=["border-gray-200","border-gray-300","border-gray-400"],j=(e,o,n,a,s)=>{const i=l?U[o%3]:L[o%3],c=l?G[o%3]:H[o%3];if(e.type==="single")return r.jsx("div",{className:`border rounded-xl-std p-4 shadow-xl-std ${i} ${c}`,children:e.path&&T(e.path,!0,!0)},n);const x=`${n}-group`,p=a.get(x)||!1;return r.jsx("div",{className:`border rounded-xl-std shadow-xl-std ${i} ${c}`,children:r.jsxs("div",{className:"p-4",children:[r.jsx("div",{className:"flex items-center justify-between mb-3",children:r.jsxs("h4",{className:`text-sm font-medium ${l?"text-gray-100":"text-gray-900"}`,children:[$(e)," Alternative Path",$(e)!==1?"s":""," (",e.children?.[0]?.path?.total_steps||0," steps)"]})}),e.common_steps&&e.common_steps.length>0&&r.jsxs("div",{className:"mb-4 border-l-2 border-blue-200 pl-4 space-y-3",children:[r.jsx("div",{className:`text-xs mb-2 ${l?"text-gray-400":"text-gray-600"}`,children:"Common steps:"}),e.common_steps.filter(y=>y.type!=="start").map((y,w,q)=>r.jsxs("div",{className:"relative",children:[r.jsx(I,{step:y,isLast:!1,showCheckbox:!0,completedStepsMap:C,favoriteIds:d,handleStepToggle:P}),w<q.length-1&&r.jsx("div",{className:"ml-3 w-px h-4 bg-gray-300"})]},w))]}),r.jsx(E,{onClick:()=>s(x),variant:"secondary",size:"md",dark:l,className:`w-full text-left p-3 rounded border transition-colors ${l?"bg-gray-700 hover:bg-gray-600 border-gray-600":"bg-gray-50 hover:bg-gray-100 border-gray-200"}`,children:r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("span",{className:`transform transition-transform ${p?"rotate-90":""}`,children:"â–¶"}),r.jsx("span",{className:`text-sm font-medium ${l?"text-gray-200":"text-gray-700"}`,children:p?"Hide alternatives":`Show ${$(e)} alternative${$(e)!==1?"s":""}`})]})})}),p&&e.children&&r.jsx("div",{className:"mt-3 space-y-3",children:e.children.map((y,w)=>j(y,o+1,`${x}-${w}`,a,s))})]})},x)},$=e=>e.children?e.children.filter(o=>o.type==="single"||o.type==="group").length:0;return r.jsxs("div",{className:"space-y-4 mt-8",children:[!f&&r.jsxs("div",{className:`rounded-xl-std p-4 border ${l?"bg-green-900/30 border-green-800/50":"bg-green-50 border-green-200"}`,children:[r.jsx("div",{className:`font-medium ${l?"text-accessible-dark":"text-accessible-light"}`,children:N||`Found ${t.total_paths} breeding path${t.total_paths!==1?"s":""}`}),r.jsxs("div",{className:`text-sm ${l?"text-accessible-secondary-dark":"text-accessible-secondary-light"}`,children:[t.start_parent," â†’ ",t.target_child," (minimum ",t.min_steps," steps)"]})]}),r.jsx("div",{className:"space-y-3",children:Array.isArray(t.paths)&&t.paths.length>0?(()=>{const e=t.paths.filter(n=>n.type==="single"),o=t.paths.filter(n=>n.type==="group");if(e.length===1&&o.length===1&&o[0].common_steps&&o[0].common_steps.length>0&&o[0].children){const n=o[0],a=[e[0],...n.children],s={...n,children:a};return[j(s,0,"root-0",k,M)]}return t.paths.flatMap((n,a)=>{const s=n;return s.type==="group"&&(!s.common_steps||s.common_steps.length===0)&&s.children?s.children.map((i,c)=>i.type==="single"?j(i,0,`root-${a}-child-${c}`,k,M):null):[j(s,0,`root-${a}`,k,M)]})})():r.jsx("div",{className:"text-center text-gray-400",children:"No breeding paths found."})})]})};export{X as E};
