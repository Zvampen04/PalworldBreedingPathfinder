import{R as K,T as R,j as t,r as h,i as O,a as Q,B as M,t as V,b as W,c as X}from"./index-DWqCGnFO.js";const P=({step:s,isLast:x=!1,showCheckbox:N=!1,path:p,completedStepsMap:u,favoriteIds:y,handleStepToggle:f})=>{var m;const i=K.useContext(R),c=(i==null?void 0:i.mode)==="dark";if(s.type==="start")return null;const d=p&&((m=u[p.id])==null?void 0:m.has(s.step_number));return t.jsxs("div",{className:`flex items-center space-x-2 ${x?c?"text-green-400 font-medium":"text-green-600 font-medium":c?"text-gray-300":"text-gray-700"} ${d?"opacity-60 line-through":""}`,children:[N&&p&&y[p.id]&&t.jsx("input",{type:"checkbox",checked:d,onChange:()=>f(p,s.step_number),className:"w-4 h-4 rounded border-2 focus:ring-2 focus:ring-blue-500","aria-checked":d,"aria-label":`Mark step ${s.step_number} as completed for breeding path from ${s.parents} to ${s.result}`}),t.jsx("span",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs ${x?c?"bg-green-800 text-green-200":"bg-green-100 text-green-800":c?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"} ${d?"bg-green-600 text-white":""}`,children:d?"✓":s.step_number}),t.jsxs("span",{children:[s.parents," → ",s.result]}),x&&t.jsx("span",{className:`text-xs px-2 py-1 rounded ${c?"bg-green-800 text-green-200":"bg-green-100 text-green-800"}`,children:"TARGET"})]})},Z=({data:s,hideSummaryHeader:x=!1,summaryHeaderText:N,onAddToCollection:p,bottomAction:u,onRemoveFavorite:y})=>{const f=h.useContext(R),i=(f==null?void 0:f.mode)==="dark",[c,d]=h.useState({}),[m,_]=h.useState({}),{memoizedFavoriteIds:E,memoizedCompletedStepsMap:z}=h.useMemo(()=>{if(s.success&&Array.isArray(s.paths)){const e={},a={},r=o=>{o.forEach(n=>{if(n.type==="single"&&n.path){const l=O(s.start_parent,s.target_child,n.path.steps);if(e[n.path.id]=l,l){const g=Q(l);g&&(a[n.path.id]=g.completedSteps)}}else n.type==="group"&&n.children&&r(n.children)})};return r(s.paths),{memoizedFavoriteIds:e,memoizedCompletedStepsMap:a}}return{memoizedFavoriteIds:{},memoizedCompletedStepsMap:{}}},[s.start_parent,s.target_child,s.success,s.paths]);h.useEffect(()=>{d(E),_(z)},[E,z]);const T=e=>{if(!s.success)return;const a=c[e.id];if(a)W(a),d(r=>({...r,[e.id]:null})),_(r=>({...r,[e.id]:new Set})),typeof y=="function"&&y(e);else{const r={name:`${s.start_parent} → ${s.target_child}`,startParent:s.start_parent,targetChild:s.target_child,steps:e.steps},o=X(r);d(n=>({...n,[e.id]:o})),window.dispatchEvent(new CustomEvent("favoritesUpdated"))}},A=(e,a)=>{const r=c[e.id];if(!r)return;V(r,a);const o=m[e.id]||new Set,n=new Set(o);n.has(a)?n.delete(a):n.add(a),_(l=>({...l,[e.id]:n})),window.dispatchEvent(new CustomEvent("favoritesUpdated"))},B=(e,a=!0,r=!1)=>{const o=c[e.id];return t.jsxs("div",{className:"border-l-2 border-blue-200 pl-4 space-y-3 relative flex flex-col pb-14",children:[t.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[t.jsx(M,{onClick:()=>T(e),variant:o?"danger":"icon",size:"sm",dark:i,title:o?"Remove from favorites":"Add to favorites","aria-label":o?"Remove from favorites":"Add to favorites",className:"",children:o?"⭐":"☆"}),t.jsx(M,{onClick:()=>p&&p(e),variant:"primary",size:"sm",dark:i,title:"Add to collection","aria-label":`Add path from ${s.start_parent} to ${s.target_child} to collection`,className:"",children:t.jsx("span",{role:"img","aria-label":"Add to collection",children:"📚"})})]}),a&&t.jsxs("div",{className:`text-sm ${i?"text-accessible-secondary-dark":"text-accessible-secondary-light"} mb-2`,children:[e.total_steps," breeding step",e.total_steps!==1?"s":""]}),e.steps.filter(n=>n.type!=="start").map((n,l,g)=>t.jsxs("div",{className:"relative",children:[t.jsx(P,{step:n,isLast:n.is_final,showCheckbox:r,path:e,completedStepsMap:m,favoriteIds:c,handleStepToggle:A}),l<g.length-1&&t.jsx("div",{className:"ml-3 w-px h-4 bg-gray-300"})]},l)),typeof u=="function"?u(e):u]})},[C,G]=h.useState(()=>{const e=new Map;if(Array.isArray(s.paths)){const a=s.paths.filter(o=>o.type==="single"),r=s.paths.filter(o=>o.type==="group");a.length===1&&r.length===1&&r[0].common_steps&&r[0].common_steps.length>0&&r[0].children?e.set("root-0-group",!0):s.paths.forEach((o,n)=>{o.type==="group"&&e.set(`root-${n}-group`,!0)})}return e}),S=e=>{G(a=>{const r=new Map(a);return r.set(e,!r.get(e)),r})},L=["bg-gray-800","bg-gray-900","bg-gray-700"],U=["border-gray-600","border-gray-700","border-gray-500"],H=["bg-white","bg-gray-100","bg-gray-200"],q=["border-gray-200","border-gray-300","border-gray-400"],v=(e,a,r,o,n)=>{var F,I,D;const l=i?L[a%3]:H[a%3],g=i?U[a%3]:q[a%3];if(e.type==="single")return t.jsx("div",{className:`border rounded-xl-std p-4 shadow-xl-std ${l} ${g}`,children:e.path&&B(e.path,!0,!0)},r);const $=`${r}-group`,k=o.get($)||!1;return t.jsx("div",{className:`border rounded-xl-std shadow-xl-std ${l} ${g}`,children:t.jsxs("div",{className:"p-4",children:[t.jsx("div",{className:"flex items-center justify-between mb-3",children:t.jsxs("h4",{className:`text-sm font-medium ${i?"text-gray-100":"text-gray-900"}`,children:[j(e)," Alternative Path",j(e)!==1?"s":""," (",((D=(I=(F=e.children)==null?void 0:F[0])==null?void 0:I.path)==null?void 0:D.total_steps)||0," steps)"]})}),e.common_steps&&e.common_steps.length>0&&t.jsxs("div",{className:"mb-4 border-l-2 border-blue-200 pl-4 space-y-3",children:[t.jsx("div",{className:`text-xs mb-2 ${i?"text-gray-400":"text-gray-600"}`,children:"Common steps:"}),e.common_steps.filter(b=>b.type!=="start").map((b,w,J)=>t.jsxs("div",{className:"relative",children:[t.jsx(P,{step:b,isLast:!1,showCheckbox:!0,completedStepsMap:m,favoriteIds:c,handleStepToggle:A}),w<J.length-1&&t.jsx("div",{className:"ml-3 w-px h-4 bg-gray-300"})]},w))]}),t.jsx(M,{onClick:()=>n($),variant:"secondary",size:"md",dark:i,className:`w-full text-left p-3 rounded border transition-colors ${i?"bg-gray-700 hover:bg-gray-600 border-gray-600":"bg-gray-50 hover:bg-gray-100 border-gray-200"}`,children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("span",{className:`transform transition-transform ${k?"rotate-90":""}`,children:"▶"}),t.jsx("span",{className:`text-sm font-medium ${i?"text-gray-200":"text-gray-700"}`,children:k?"Hide alternatives":`Show ${j(e)} alternative${j(e)!==1?"s":""}`})]})})}),k&&e.children&&t.jsx("div",{className:"mt-3 space-y-3",children:e.children.map((b,w)=>v(b,a+1,`${$}-${w}`,o,n))})]})},$)},j=e=>e.children?e.children.filter(a=>a.type==="single"||a.type==="group").length:0;return t.jsxs("div",{className:"space-y-4 mt-8",children:[!x&&t.jsxs("div",{className:`rounded-xl-std p-4 border ${i?"bg-green-900/30 border-green-800/50":"bg-green-50 border-green-200"}`,children:[t.jsx("div",{className:`font-medium ${i?"text-accessible-dark":"text-accessible-light"}`,children:N||`Found ${s.total_paths} breeding path${s.total_paths!==1?"s":""}`}),t.jsxs("div",{className:`text-sm ${i?"text-accessible-secondary-dark":"text-accessible-secondary-light"}`,children:[s.start_parent," → ",s.target_child," (minimum ",s.min_steps," steps)"]})]}),t.jsx("div",{className:"space-y-3",children:Array.isArray(s.paths)&&s.paths.length>0?(()=>{const e=s.paths.filter(r=>r.type==="single"),a=s.paths.filter(r=>r.type==="group");if(e.length===1&&a.length===1&&a[0].common_steps&&a[0].common_steps.length>0&&a[0].children){const r=a[0],o=[e[0],...r.children],n={...r,children:o};return[v(n,0,"root-0",C,S)]}return s.paths.flatMap((r,o)=>{const n=r;return n.type==="group"&&(!n.common_steps||n.common_steps.length===0)&&n.children?n.children.map((l,g)=>l.type==="single"?v(l,0,`root-${o}-child-${g}`,C,S):null):[v(n,0,`root-${o}`,C,S)]})})():t.jsx("div",{className:"text-center text-gray-400",children:"No breeding paths found."})})]})};export{Z as E};
